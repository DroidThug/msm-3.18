From ab03d13d509ba1e40ea619d51ab59e5389caacd8 Mon Sep 17 00:00:00 2001
From: lnxbuild <lnxbuild@localhost>
Date: Mon, 9 Sep 2013 16:59:36 +0800
Subject: [PATCH 14/16] fix LP sensor tmd27727 suspend crash issue

Change-Id: Ia4a883683f6f07d9f03d5e45d781512263b973c0
---
 drivers/input/misc/tmd277x.c |   35 ++++++++++++-----------------------
 1 files changed, 12 insertions(+), 23 deletions(-)

diff --git a/drivers/input/misc/tmd277x.c b/drivers/input/misc/tmd277x.c
index 99b95db..e40be06 100644
--- a/drivers/input/misc/tmd277x.c
+++ b/drivers/input/misc/tmd277x.c
@@ -1397,34 +1397,23 @@ init_failed:
 
 static int taos_suspend(struct device *dev)
 {
+
 	struct tmd2772_chip *chip = dev_get_drvdata(dev);
-	struct tmd2772_i2c_platform_data *pdata = dev->platform_data;
+//	struct tmd2772_i2c_platform_data *pdata = dev->platform_data;
 
 	dev_dbg(dev, "%s\n", __func__);
 	mutex_lock(&chip->lock);
 	chip->in_suspend = 1;
-	if (chip->p_idev && chip->p_idev->users) {
-		if (pdata->proximity_can_wake) {
-			dev_dbg(dev, "set wake on proximity\n");
-			chip->wake_irq = 1;
-		} else {
-			dev_dbg(dev, "proximity off\n");
-			taos_prox_enable(chip, 0);
-		}
-	}
-	if (chip->a_idev && chip->a_idev->users) {
-		if (pdata->als_can_wake) {
-			dev_dbg(dev, "set wake on als\n");
-			chip->wake_irq = 1;
-		} else {
-			dev_dbg(dev, "als off\n");
-			taos_als_enable(chip, 0);
-		}
-	}
-	if (chip->wake_irq) {
-		irq_set_irq_wake(chip->client->irq, 1);
-	} else if (!chip->unpowered) {
-		dev_dbg(dev, "powering off\n");
+//	if (chip->p_idev && chip->p_idev->users) {
+		printk("proximity off1\n");
+		taos_prox_enable(chip, 0);
+//	}
+//	if (chip->a_idev && chip->a_idev->users) {
+		printk("proximity off2\n");
+		taos_als_enable(chip, 0);
+//	}
+	if (!chip->unpowered) {
+		printk("proximity off3\n");
 		pltf_power_off(chip);
 	}
 	mutex_unlock(&chip->lock);
-- 
1.7.8.3

